if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("MMessagesNewMessageBlockRenderer",["ActorURI","CurrentUser","DOM","HTML","MDynaTemplate","MMessageUtils","MMessagesBubbleMaker","MMessagesThreadImageRenderer","MRequest","XMessagingDeferredAttachmentController","emojiAndEmote","gkx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h="\xb7",i="text",j="deferred";function a(a,b){var e,f,g=c("gkx")("806617");f=c("nullthrows")((f=b)!=null?f.show_prim_webview_redesign:f);e=c("nullthrows")((e=b)!=null?e.user:e);e=f?e==a.getAuthorFBID():c("CurrentUser").getID()===a.getAuthorFBID();var h=a.getMessage(),i={author_name:a.getAuthorName(),author_href:b.author_href,message:h},l=null;b.should_parse_emoticons&&(l=d("DOM").create("span",{},c("emojiAndEmote")(i.message,{isSupportedEmoji:b.is_supported_emoji,getMessengerEmote:b.get_messenger_emote})),i.message="");g&&h!==null&&h!==""&&(l=d("MMessagesBubbleMaker").createFromElement(l,e));var p;h=m(a);if(h===j){h=n(a);i.deferred_attachment_id=h;p=d("MDynaTemplate").renderToHtml(g?e?"@MDeferredAttachmentMessageRedesignSenderTemplate":"@MDeferredAttachmentMessageRedesignReceiverTemplate":"@MDeferredAttachmentMessageTemplate",i);h=c("XMessagingDeferredAttachmentController").getURIBuilder().setString("dest_id",h).setString("mid",a.getUUID()).setBool("from_viewer",e).getURI();h=d("ActorURI").create(h,b.page_id).toString();new(c("MRequest"))(h).setMethod("GET").send()}else p=d("MDynaTemplate").renderToHtml(g?e?"@MChatMessageRedesignSenderTemplate":"@MChatMessageRedesignReceiverTemplate":"@MChatMessageTemplate",i);h=new(c("HTML"))(p).getFragment().firstChild;if(!g||!e){i=d("DOM").find(h,"*","profile_image");d("DOM").replace(i,d("MMessagesThreadImageRenderer").participantImage(a.getAuthorFBID(),43,o(a)))}if(b.should_parse_emoticons){p=d("DOM").find(h,"div","message-text");p.appendChild(l)}if(!e&&a.getAuthorFBID()!==b.user&&!f){g=k(a.getMessageSource(),b.download_link);i=d("DOM").find(h,"div","action-list");d("DOM").appendContent(i,g)}return h}function k(a,b){var e=d("MMessageUtils").getMessageSourceText(a);if(!e)return"";var f="";l(a,b)?f=d("MDynaTemplate").renderToHtml("@MMessageSourceTextWithLinkTemplate",{text:e,download_href:b}):f=d("MDynaTemplate").renderToHtml("@MMessageSourceTextTemplate",{text:e});a=d("DOM").create("span",new(c("HTML"))(f));d("DOM").prependContent(a,new(c("HTML"))(" "+h+" "));return a}function l(a,b){return!(a==="source:chat:orca"||a==="source:titan:orca")?!1:!!b}function m(a){return a.getAttachmentCount()?j:i}function n(a){return"deferred_attachment:"+a.getUUID()}function o(a){var b=parseInt(a.getAuthorFBID(),10);return a.getWorkForeignParticipantIds().indexOf(b)>-1}g["default"]=a}),98);