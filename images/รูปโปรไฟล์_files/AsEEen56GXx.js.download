if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("MMessages",["$","CSS","DOM","MDateString","MInViewportManager","MLegacyDataStore","MMessageUtils","MMessagesNewMessageBlockRenderer","MMessagesNewTextMessageRenderer","MMessagesReadReceipts","MMessagesReadReceiptsDOM","MOrionAttachmentBody","MP2PNUXRendererUtils","MQuickReplies.react","MReactComponentRenderer","MSuggestionPopup.react","MViewport","MessengerSupportedEmoji","UserAgent","clearTimeout","gkx","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";var h=c("UserAgent").isBrowser("Facebook Messenger"),i=62,j=86,k=c("gkx")("1539623"),l="sugg-container",m=c("gkx")("7284");a=function(){function a(a){var b=this;this.handleUserTyping=function(a){if(!c("gkx")("1416941"))return;a=a.getData();b._typingIndicator&&a.from==b._messageSubject&&(d("DOM").show(b._typingIndicator),c("clearTimeout")(b._deferredHide),b._deferredHide=c("setTimeoutAcrossTransitions")(function(){b._typingIndicator&&d("DOM").hide(b._typingIndicator)},4e3))};this.handlePageLoad=function(){k&&b._scrollSuggestionIntoView(),b._scrollLastMessageIntoViewIfNecessary()};this.handleMessageReceived=function(a){a=a.getData();if(a.event==="read_receipt"&&a.is_sync){b._readReceipts(a);return}var e=!1;if(k){var f;if((f=a.message)==null?void 0:(f=f.meta_ranges)==null?void 0:(f=f.data)==null?void 0:f.m_suggestion_data){f=JSON.parse((f=a.message)==null?void 0:(f=f.meta_ranges)==null?void 0:(f=f.data)==null?void 0:f.m_suggestion_data);if(Object.prototype.hasOwnProperty.call(f,"suggested_reply_location")||Object.prototype.hasOwnProperty.call(f,"suggested_reply_user_faq")||Object.prototype.hasOwnProperty.call(f,"suggested_reply_user_faq_saved_reply")){var g=Object.values(f)[0];f=Object.keys(f)[0];b._createSuggestionPopup(a.targetFBID,b._messageOtherUserFBID,String(g),String(f))}e=!0}}g=a.parsedPayload;f=a.targetFBID;if(!g||!b._payloadIsForThisThread(g,f)||b._alreadyHasMessage(g.getUUID()))return;b._typingIndicator&&(c("clearTimeout")(b._deferredHide),d("DOM").hide(b._typingIndicator));d("MMessagesReadReceiptsDOM").clearAll();f=b._addNewMessage(g);f instanceof HTMLElement&&(b._showPrimWebviewRedesign?f.scrollIntoView():(c("CSS").conditionClass(f,"chatHighlight",!0),d("MViewport").scrollToNode(c("$")("composerInput"))));if(m&&((g=a.message)==null?void 0:g.platform_xmd)){g=JSON.parse((f=a.message)==null?void 0:f.platform_xmd);f=g==null?void 0:g.quick_replies;if(f&&Array.isArray(f)){g=f.map(function(a){return{displayText:a.title,xmd:JSON.stringify({quick_replies:a})}});b._createQuickReplies(g);e=!0}}(k||m)&&!e&&((f=a.message)==null?void 0:f.action_type)==="ma-type:user-generated-message"&&b._createSuggestionPopup(a.targetFBID,b._messageOtherUserFBID,null,null)};this._user=a.userID;this._pageID=a.pageID;this._messageSubject=a.messageSubject;this._messageThreadID=a.messageThreadID;this._messageOtherUserFBID=a.messageOtherUserFBID;this._messageThreadFBID=a.messageThreadFBID;a.isCanonicalThread&&(this._typingIndicator=a.typingIndicatorElement);this._usersProfileUri=a.usersProfileUri;this._usersShortNames=a.usersShortNames;this._parseEmoticons=a.parseEmoticons;this._downloadLink=a.downloadLink;this._orcaPromotionBoxVisible=!1;this._showPrimWebviewRedesign=Boolean(a==null?void 0:a.showPrimWebviewRedesign)}var b=a.prototype;b.handleModuleLoad=function(){k&&this._scrollSuggestionIntoView(),this._scrollLastMessageIntoViewIfNecessary()};b._scrollSuggestionIntoView=function(){document.getElementById(l)&&c("$")(l).scrollIntoView()};b._removeSuggestionPopup=function(){document.getElementById(l)&&d("DOM").remove(c("$")(l))};b._createSuggestionPopup=function(a,b,e,f){var g;this._removeSuggestionPopup();var h=d("DOM").create("div",{id:l});d("DOM").appendContent(c("$")("messageGroup"),[h]);(g=document.getElementById(l))==null?void 0:g.setAttribute("style","display: flex; justify-content: center; text-align: center;");c("MReactComponentRenderer")(c("MSuggestionPopup.react"),h,{pageID:a,userID:b,suggestedReply:e,suggestedReplyType:f});this._scrollSuggestionIntoView()};b._createQuickReplies=function(a){var b;this._removeSuggestionPopup();var e=d("DOM").create("div",{id:l});d("DOM").appendContent(c("$")("messageGroup"),[e]);(b=document.getElementById(l))==null?void 0:b.setAttribute("style","display: flex; justify-content: center; text-align: center;");c("MReactComponentRenderer")(c("MQuickReplies.react"),e,{replies:a})};b._scrollLastMessageIntoViewIfNecessary=function(){if(this._showPrimWebviewRedesign){var a=d("DOM").scry(c("$")("messageGroup"),"div","message-xhp").pop(),b=h?j:i;a&&!d("MInViewportManager").isInViewport(a,-b)&&a.scrollIntoView()}};b._payloadIsForThisThread=function(a,b){if(this._pageID&&this._pageID!=b)return!1;if(this._messageOtherUserFBID!==null)return this._messageOtherUserFBID===a.getOtherUserFBID();else if(this._messageThreadFBID!==null)return this._messageThreadFBID===a.getThreadFBID();return!1};b._addNewMessage=function(a){var b=d("DOM").scry(c("$")("messageGroup"),"div","message-xhp").pop();if(this._shouldCreateNewMessageBlock(b,a)){var e={author_href:this._usersProfileUri[a.getAuthorFBID()],page_id:this._pageID,should_parse_emoticons:this._parseEmoticons,user:this._user,download_link:this._downloadLink,is_supported_emoji:d("MessengerSupportedEmoji").isSupportedEmoji,get_messenger_emote:d("MessengerSupportedEmoji").getMessengerEmote,show_prim_webview_redesign:this._showPrimWebviewRedesign};e=c("MMessagesNewMessageBlockRenderer")(a,e);var f={name:a.getAuthorName(),attachment_count:a.getAttachmentCount(),message_source:this._showPrimWebviewRedesign?null:a.getMessageSource()};d("MLegacyDataStore").set(e,f);this._setTimestamp(e);f=d("DOM").scry(e,"img","attachment-image");f.forEach(function(a){a.addEventListener("load",function(){d("MViewport").scrollToNode(c("$")("composerInput"))})});f=d("DOM").find(e,"div","message-text");f.setAttribute("data-testid","message-block");d("MLegacyDataStore").set(f,this._getMessageTextData(a));d("DOM").appendContent(c("$")("messageGroup"),e);f=this._createSystemNewMessageBlock(a);f&&d("DOM").appendContent(c("$")("messageGroup"),f);!this._orcaPromotionBoxVisible&&this._orcaPromotionBox&&this._shouldDisplayOrcaPromotionBox(a)&&(d("DOM").show(this._orcaPromotionBox),this._orcaPromotionBoxVisible=!0);f=e}else f=this._addMessageToExisting(b,a);return f};b._shouldDisplayOrcaPromotionBox=function(a){return(a.getMessageSource()==="source:chat:orca"||a.getMessageSource()==="source:titan:orca")&&a.getAuthorFBID()!==this._user?!0:!1};b._shouldCreateNewMessageBlock=function(a,b){if(!a)return!0;a=d("MLegacyDataStore").get(a);if(d("MMessageUtils").getMessageSourceText(a.message_source)!=d("MMessageUtils").getMessageSourceText(b.getMessageSource()))return!0;return a.name==b.getAuthorName()&&!a.attachment_count&&!b.getAttachmentCount()?!1:!0};b._readReceipts=function(a){a=Object.keys(a.message.roger)[0];if(a!==(this._messageOtherUserFBID||this._messageThreadFBID))return;d("MMessagesReadReceiptsDOM").clearAll();a=d("DOM").scry(c("$")("messageGroup"),"div","message-text").reverse();var b=a.map(function(a){return d("MLegacyDataStore").get(a)}),e=this._pageID||this._user,f={};f[e]=!0;for(var e=0,g;g=b[e];e++){f[g.author]=!0;g=d("MMessagesReadReceipts").getSeenBy(this._messageOtherUserFBID?this._messageOtherUserFBID:this._messageThreadFBID,parseInt(g.timestamp,10),Object.keys(f));for(var h in g)f[h]=!0;if(Object.keys(g).length){h={users_short_names:this._usersShortNames,user:this._user};d("MMessagesReadReceiptsDOM").addNew(a[e],b[e],g,h)}}};b._alreadyHasMessage=function(a){if(a){var b=d("DOM").scry(c("$")("messageGroup"),"div","message-text");for(var e=0,f;f=b[e];e+=1){f=d("MLegacyDataStore").get(f);if(f.uuid==a)return!0}}return!1};b._getMessageTextData=function(a){return{author:a.getAuthorFBID(),timestamp:a.getTimestamp(),uuid:a.getUUID()}};b._addMessageToExisting=function(a,b){a=d("DOM").find(a,"span","message-body").parentNode;var e={should_parse_emoticons:this._parseEmoticons,is_supported_emoji:d("MessengerSupportedEmoji").isSupportedEmoji,get_messenger_emote:d("MessengerSupportedEmoji").getMessengerEmote,user:this._user,show_prim_webview_redesign:this._showPrimWebviewRedesign};e=c("MMessagesNewTextMessageRenderer")(b,e);d("MLegacyDataStore").set(e,this._getMessageTextData(b));d("DOM").appendContent(a,e);return e};b._createSystemNewMessageBlock=function(a){var b=null;if(c("MOrionAttachmentBody").module){a=d("MP2PNUXRendererUtils").getTransferFromAttachments((a.getAttachments()||[]).map(function(a){return a==null?void 0:a.extensible_attachment}).filter(Boolean));if(a){a={transactionId:a.transfer_id,senderId:a.sender.id};b=c("MOrionAttachmentBody").module.createNUX(a,function(){return d("MViewport").scrollToNode(c("$")("composerInput"))})}}return b};b._setTimestamp=function(a){a=d("DOM").find(a,"abbr","timestamp");a.setAttribute("data-meta",null);var b=Math.floor(Date.now()/1e3);d("MLegacyDataStore").set(a,{time:b});d("DOM").setContent(a,d("MDateString").displayTime(b))};return a}();Object.assign(a.prototype,{_user:null,_deferredHide:null,_messageSubject:null,_messageThreadID:null,_messageOtherUserFBID:null,_messageThreadFBID:null,_typingIndicator:null,_usersProfileUri:null,_usersShortNames:null});g["default"]=a}),98);